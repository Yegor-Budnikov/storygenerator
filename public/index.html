<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Story Generator 0.1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 20px auto;
            text-align: center;
        }
        textarea, input[type="button"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
        }
        #output {
            border: 1px solid #ccc;
            padding: 10px;
            height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .nav-menu {
            margin-bottom: 20px;
        }
        .filter-label {
            text-align: left;
            margin: 5px 0;
        }
    </style>
</head>
<body>

    <h1>Welcome to the Story Generator</h1>

    <div class="nav-menu">
        <select id="navMenu" onchange="navigatePage()">
            <option value="generate">Generate Story</option>
            <option value="saved">View Saved Stories</option>
        </select>
    </div>

    <p>Select filters for your story:</p>
    
     <!-- Filters Section (Each filter on a new line) -->
    <div>
        <label for="style" class="filter-label">Style:</label>
        <select id="style">
            <option value="none">Any</option>
            <option value="humorous">Humorous</option>
            <option value="dramatic">Dramatic</option>
            <option value="whimsical">Whimsical</option>
        </select>
    </div>

    <div>
        <label for="complexity" class="filter-label">Complexity:</label>
        <select id="complexity">
            <option value="none">Any</option>
            <option value="simple">Simple</option>
            <option value="intermediate">Intermediate</option>
            <option value="complex">Complex</option>
        </select>
    </div>

    <div>
        <label for="length" class="filter-label">Length:</label>
        <select id="length">
            <option value="none">Any</option>
            <option value="short">Short</option>
            <option value="medium">Medium</option>
            <option value="long">Long</option>
        </select>
    </div>

    <div>
        <label for="characters" class="filter-label">Character Types:</label>
        <select id="characters">
            <option value="none">Any</option>
            <option value="animals">Animals</option>
            <option value="people">People</option>
        </select>
    </div>

    <div>
        <label for="plot" class="filter-label">Plot Structure:</label>
        <select id="plot">
            <option value="none">Any</option>
            <option value="linear">Linear</option>
            <option value="nonlinear">Non-linear</option>
            <option value="twist">Twist Ending</option>
        </select>
    </div>

    <div>
        <label for="scriptStyle" class="filter-label">Script Style:</label>
        <select id="scriptStyle">
            <option value="none">Any</option>
            <option value="million-dollar">"The Million-Dollar Story"</option>
            <option value="save-the-cat">"Save the Cat! beat sheet"</option>
            <option value="heros-journey">"The Hero's Journey"</option>
            <option value="three-act">"The Three-Act Structure"</option>
        </select>
    </div>

    <div>
        <label for="customScript" class="filter-label">Custom Script Style (Movie or Genre):</label>
        <input type="text" id="customScript" placeholder="Enter custom movie/script style...">
    </div>


    <p>Enter a prompt below and click "Generate Story" to get a response:</p>
   <textarea id="prompt" rows="5" placeholder="Enter your prompt here, for example, names of the main characters, their backstory, any details that you want to see in the story...

You don't have to. The prompt is optional. If you don't have anything in mind just click the button below:)"></textarea>
    <input type="button" value="Generate Story" onclick="generateStory()">
    <div id="output">The story will appear here...</div>
    <input type="button" value="Copy to Clipboard" onclick="copyToClipboard()">
    <input type="button" value="Save the Story" onclick="saveStory()">

    <script>

        function navigatePage() {
            const selectedPage = document.getElementById('navMenu').value;
            if (selectedPage === 'saved') {
                window.location.href = 'saved-stories.html';
            }
        }

        async function generateStory() {
            const prompt = document.getElementById('prompt').value;

            // Get filter values
            const style = document.getElementById('style').value;
            const complexity = document.getElementById('complexity').value;
            const length = document.getElementById('length').value;
            const characters = document.getElementById('characters').value;
            const plot = document.getElementById('plot').value;
            const scriptStyle = document.getElementById('scriptStyle').value;
            const customScript = document.getElementById('customScript').value;

            // Ensure that values are sent correctly to the server
            console.log({
                prompt,
                scriptStyle,
                customScript
            });

            // Send filters along with the prompt to the server
            const response = await fetch('/generate-story', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    prompt,
                    style,
                    complexity,
                    length,
                    characters,
                    plot,
                    scriptStyle,
                    customScript
                }),
            });


            const data = await response.json();
            const outputDiv = document.getElementById('output');
            if (data.story) {
                outputDiv.textContent = data.story;
            } else {
                outputDiv.textContent = 'No story generated. Please try again.';
            }
        }

        function copyToClipboard() {
            const storyText = document.getElementById('output').textContent;
            const tempInput = document.createElement('textarea');
            tempInput.value = storyText;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert('Story copied to clipboard!');
        }

        function saveStory() {
            const storyText = document.getElementById('output').textContent;
            if (!storyText) {
                alert('No story to save.');
                return;
            }

            const savedStories = JSON.parse(localStorage.getItem('savedStories')) || [];

            if (savedStories.some(story => story.content === storyText)) {
                alert('This story is already saved.');
                return;
            }

            const timestamp = new Date().toLocaleString(); 
            savedStories.push({ title: timestamp, content: storyText });
            localStorage.setItem('savedStories', JSON.stringify(savedStories));

            alert('Story saved successfully!');
        }

    </script>

</body>
</html>
